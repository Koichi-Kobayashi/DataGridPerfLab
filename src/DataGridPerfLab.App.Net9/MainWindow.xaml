<Window xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        x:Class="MainWindow"
        Title="DataGridPerfLab" Width="1350" Height="800">
    <DockPanel>
        <Border DockPanel.Dock="Top" Padding="10">
            <StackPanel Orientation="Vertical">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <Button Width="150" Margin="0,0,10,0"
                            Content="10万件を再生成" Click="OnRebuild"/>
                    <Button Width="220" Margin="0,0,10,0"
                            Content="フィルター / ソート / グループ適用"
                            Click="OnApplyView"/>
                    <Button Width="220" Margin="0,0,10,0"
                            Content="スコアを変更 (5,000件)"
                            Click="OnMutateScores"/>
                    <TextBlock x:Name="StatusText"
                               VerticalAlignment="Center"
                               Text="Ready"/>
                </StackPanel>

                <WrapPanel Margin="0,10,0,0" VerticalAlignment="Center">
                    <CheckBox x:Name="BatchToggle"
                              Content="ItemsSource をまとめて差し替え（高速）"
                              IsChecked="True" Margin="0,0,18,0"/>


<StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,18,0">
    <TextBlock VerticalAlignment="Center" Text="生成方式：" Margin="0,0,6,0"/>
    <ComboBox x:Name="BuildModeCombo" Width="220" SelectedIndex="0">
        <ComboBoxItem Content="逐次 (Sequential)"/>
        <ComboBoxItem Content="並列 (ConcurrentBag)"/>
        <ComboBoxItem Content="並列 (Array)"/>
    </ComboBox>
</StackPanel>

                    <Separator Width="10"/>

                    <CheckBox x:Name="FilterEvenToggle"
                              Content="フィルター：ID が偶数のみ"
                              IsChecked="False" Margin="0,0,18,0"/>

                    <CheckBox x:Name="FilterScoreToggle"
                              Content="フィルター：Score が 50 以上"
                              IsChecked="False" Margin="0,0,18,0"/>

                    <Separator Width="10"/>

                    <CheckBox x:Name="SortIdDescToggle"
                              Content="ソート：ID 降順"
                              IsChecked="False" Margin="0,0,18,0"/>

                    <CheckBox x:Name="SortScoreDescToggle"
                              Content="ソート：Score 降順"
                              IsChecked="False" Margin="0,0,18,0"/>

                    <Separator Width="10"/>

                    <CheckBox x:Name="GroupByCategoryToggle"
                              Content="グループ：Score / 10"
                              IsChecked="False" Margin="0,0,18,0"/>

                    <Separator Width="10"/>

                    <CheckBox x:Name="UseDeferRefreshToggle"
                              Content="Use DeferRefresh（View変更の一括反映）"
                              IsChecked="True" Margin="0,0,18,0"/>

                    <CheckBox x:Name="LiveShapingToggle"
                              Content="Enable LiveShaping（値変更に追従）"
                              IsChecked="True" Margin="0,0,18,0"/>

                    <Separator Width="10"/>

                    <CheckBox x:Name="VirtualizationToggle"
                              Content="仮想化（行・列）"
                              IsChecked="True"
                              Checked="OnVirtualizationChanged"
                              Unchecked="OnVirtualizationChanged"
                              Margin="0,0,18,0"/>
                </WrapPanel>

                <TextBlock Margin="0,6,0,0" Foreground="Gray"
                           Text="※ DeferRefresh は View（Filter / Sort / Group）の変更をまとめるための仕組みです。LiveShaping はプロパティ変更に応じて自動で再評価されます。"/>
            </StackPanel>
        </Border>

        <DataGrid x:Name="Grid"
                  ItemsSource="{Binding Items}"
                  AutoGenerateColumns="True"
                  EnableRowVirtualization="True"
                  EnableColumnVirtualization="True"
                  VirtualizingPanel.IsVirtualizing="True"
                  VirtualizingPanel.VirtualizationMode="Recycling"
                  ScrollViewer.CanContentScroll="True"
                  IsReadOnly="True"/>
    </DockPanel>
</Window>
